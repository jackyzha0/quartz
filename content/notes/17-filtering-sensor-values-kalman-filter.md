---
title: "17-filtering-sensor-values-kalman-filter"
tags: 
- info305
- lecture
---



> [!INFO] other methods dont take into account the noise of the data
> not predicting from a series of states

> [!IMPORTANT] only predicting from a single inital known state
> spread around midpoint using a gaussian distribution. 
> we have a probability of a midpoint.

> [!INFO] we can get information about accuracy of sensors from specifications on the sensors.

> [!INFO] use vectors because there could be multiple sensors, each with multple values.

> [!INFO] to make predictions we need. prediction. kalman gain (K), 
> K is the ratio of trust in the prediction vs the measurement. higher K means more trust in accumulated predictions. higher means means smoother results. but more latency


> [!INFO] sensor fusion and individual sensor prediction

![Activity/Context Recognition|300](https://i.imgur.com/MUdRlDa.png)


Kalman Filter for Sensor Fusion
- sensor fusion: dead-reckoning, low/high pass filters

- A very simple example: 
- Position of a train, human, car, phone, device, … 
- 1DoF (Simplification of a 2DoF/3DoF positioning problem)
- Train has state xₜ which is based on the current position and the velocity
- How to determine the state xₜ₊₁? when measurement of current state and velocity have error

- Solution for the simplified scenario is based on a Markov chain: 
- A Markov chain is "a stochastic model describing a sequence of possible events in which the probability of each event depends only on the state attained in the previous event.

![|300](https://i.imgur.com/1jh2FS3.png)
![|300](https://i.imgur.com/FYgsOdy.png)

Hidden Markov Model (HMM)
![Hidden Markov Model (HMM)|300](https://i.imgur.com/U6LZrU9.png)
![|300](https://i.imgur.com/sSLxx7Y.png)

![Assumptions|300|300:](https://i.imgur.com/eh1Cmho.png)


- The initial knowledge of the system at time t = 0. 
- The red Gaussian distribution represents the pdf (probability density function) providing the initial confidence in the estimate of the position of the train 
- The arrow pointing to the right represents the known initial velocity of the train
![|300](https://i.imgur.com/PXsPt8a.png)

- The prediction of the location of the train at time t = 1 and the level of uncertainty 
- The confidence in the knowledge of the position of the train has decreased 
- We are not certain if the train has undergone any accelerations or decelerations in the intervening period from t = 0 to t = 1.
![|300](https://i.imgur.com/yyvoSB1.png)

- Shows the measurement of the location of the train at time t = 1 
- Noisy measurement (Level of uncertainty is represented by the blue Gaussian pdf) 
- The combined knowledge of this system is provided by multiplying these two pdfs together 
- A key property of Gaussion pdf: The product of two Gaussian pdfs is another Gaussian pdf
![|300](https://i.imgur.com/Pt7k4BT.png)

- Shows the new pdf (green) generated by multiplying the pdfs associated with the prediction and measurement of the train’s location at time t = 1. 
- This new pdf provides the best estimate of the location of the train, by fusing the data from the prediction and the measurement.
![|300](https://i.imgur.com/y2pQFRe.png)

Kalman Filter - Problem Statement
- The system you need to model must fullfil the following characteristic: 
- State of a system at a time t
![|100](https://i.imgur.com/a0zmW60.png)
- Measurements of the system at a time t
![|100](https://i.imgur.com/V2OByEE.png)

Equations
![](https://i.imgur.com/6qQmuu6.png)
![](https://i.imgur.com/g8dbV4I.png)

Kalman Filter - Predict and Correct
- Running the filter: 
- Two steps: Predict and Correct
![Predict and Correct Cycle|300](https://i.imgur.com/KrCVMab.png)

- (3) In simple words, the new best estimate is a prediction made from previous best estimate, plus a correction for known external influences. 
- (4) The new uncertainty is predicted from the old uncertainty, with some additional uncertainty from the environment.
- ![](https://i.imgur.com/CHEzMAG.png)

- (5) In simple words the estimation of the state after the measurement, is the prediction from the last state plus the Kalman gain (K) times the innovation. The innovation is the difference between measurement and where we expected to find the measurement.
- (6) The new uncertainty is estimated from the predicted uncertainty, corrected with the Kalman gain (K) times
- (7) The Kalman gain is the relative weight given to the measurements and current state estimate [0..1]. If there is high uncertainty relative to the process noise (e.g. sensor noise), the gain will be low, otherwise it would be high. As the filter converges, the gains gets smaller, into a steady state.
- ![](https://i.imgur.com/Ksg5QAL.png)

https://simondlevy.academic.wlu.edu/kalman-tutorial/the-extended-kalman-filter-an-interactive-tutorial-for-non-experts-part-14/
![](https://i.imgur.com/CKKOyQR.png)


Kalman Filter: 
- Kalman filter is an algorithm permitting exact inference in a linear dynamical system 
- All latent and observed variables have a Gaussian distribution 
- Optimal estimator for smoothing noisy data, providing estimates of parameters of interest, and fusing sensors with different characteristics 
- Applications include global positioning system receivers, smoothing the output from laptop trackpads, smoothing noisy sensors, general sensor fusion, and more

Examples
- Example 1: https://home.wlu.edu/~levys/kalman_tutorial/kalman_07.html (Simple Example) 
- Example 2: https://home.wlu.edu/~levys/kalman_tutorial/kalman_14.html (Sensor Fusion) 
- Kalman Filter in pictures (very good but still mathematical): http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/ 
- Kalman Filter Tutorial: http://www.cs.unc.edu/~welch/kalman/ 
- Kalman Filter Code: https://github.com/simondlevy/TinyEKF